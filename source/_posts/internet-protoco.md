---
title: 计算机网络之各层协议整理
date: 2026-01-14 13:39:48
tags:
    - 学习
    - 计算机网络
categories:
    - 大二
---


九乡河文理学院/苏州校区/NULL学院/甲辰年-乙巳年春学期/计算机网络之各层协议整理

个人复习的时候这些总是搞混，所以整理了一些
<!-- more -->

# 计算机网络

{% quote green %}
内容整合了课件、课本、GPT老师和DS老师
{% endquote %}

## 1. 应用层（Application Layer）

**功能**：直接为用户进程提供服务，定义应用间通信的规则（报文格式、动作语义）。

**典型协议**：
| 协议 | 用途 | 依赖的传输层协议 |
|-------|-------------------------------|------------------|
| HTTP | 网页浏览（Web） | TCP |
| HTTPS | 加密的HTTP（安全网页） | TCP |
| FTP | 文件传输 | TCP |
| SMTP | 电子邮件发送 | TCP |
| POP3/IMAP | 电子邮件接收 | TCP |
| DNS | 域名解析（域名→IP） | UDP/TCP |
| DHCP | 动态分配IP地址 | UDP |
| SSH | 安全远程登录 | TCP |
| RTP | 实时音视频传输（如Zoom） | UDP |
| SNMP | 网络设备管理 | UDP |



## 2. 运输层（Transport Layer）

**功能**：提供**端到端**（进程到进程）的通信，区分可靠性与实时性需求。

**核心协议**：
| 协议 | 特点 | 适用场景 |
|------|-------------------------------|------------------------------|
| TCP | 可靠传输、面向连接、流量控制 | 网页（HTTP）、邮件（SMTP）等 |
| UDP | 不可靠但高效、无连接 | DNS、视频流、VoIP等 |
| SCTP | 多路径传输（特殊场景） | 电信网络 |



## 3. 网络层（Network Layer）

**功能**：实现**主机到主机**的通信，负责路由选择与分组转发。

* 只有IP协议，其他都算中间件*middle box*

**核心协议/技术**：
| 协议/技术 | 用途 |
|------------|-----------------------------------|
| IP (IPv4/IPv6) | 数据包的路由与寻址（核心协议） |
| ICMP | 网络状态诊断（如`ping`、`traceroute`） |
| IGMP | 组播管理 |
| OSPF/BGP | 动态路由协议（内部/外部网关协议） |
| ARP | IP地址→MAC地址解析（虽属链路层，但服务于网络层） |



## 4. 链路层（Data Link Layer）

**功能**：解决**相邻节点**（直连设备）的帧传输，处理物理寻址与差错控制。

**典型协议/技术**：
| 协议/技术 | 用途 |
|----------------|-----------------------------------|
| 以太网（Ethernet） | 有线局域网（LAN）标准 |
| Wi-Fi (802.11) | 无线局域网 |
| PPP | 点对点链路（如拨号上网） |
| MAC协议 | 控制物理介质访问（如CSMA/CD） |
| VLAN | 虚拟局域网划分 |
| HDLC | 广域网帧封装 |

* * *

## **协议与层级关系图示**

```
    应用层  → HTTP, FTP, DNS...  
              ↓  
    运输层  → TCP, UDP  
              ↓  
    网络层  → IP, ICMP, OSPF  
              ↓  
    链路层  → Ethernet, Wi-Fi, ARP  
              ↓  
    物理层  → 比特流传输（无具体协议）
```

* * *

### **关键记忆点**

1. **应用层**：面向用户，协议定义“做什么”（如HTTP请求网页）。
2. **运输层**：区分“可靠与否”（TCP/UDP），端口号定位进程。
3. **网络层**：IP地址全局寻址，路由协议决定路径。
4. **链路层**：MAC地址局部寻址，帧传输相邻节点。

**特殊注意**：

* **ARP**虽在链路层实现，但服务于网络层（IP→MAC）。
* **DNS**在应用层，但通常基于UDP传输。

* * *


在网络层的数据平面中，基于目的地转发需要路由器使用转发表来查找输出端口，使到达的分组能经过交换结构转发到该输出端口。转发表`forward table`是由路由选择处理器计算和更新或者接受来自远程`SDN`控制器的内容，表项是前缀匹配和链路接口。链路层的地址解析协议`ARP`是将`IP`地址到`MAC`地址的转换，表项为`IP`地址、`MAC`地址、`TTL`而链路层交换机的过滤：决定一个帧应该转发到某个接口还是应该将其丢弃；转发：决定一个帧应该被导向哪个接口并把该帧移动到那些接口的交换机功能。它们借助于交换机表`switch table`，表项包括`MAC`地址，通向该`MAC`地址的交换机接口，表项放在表中的时间。

* * *


{% quote green %}
来自GPT
{% endquote %}


## 🌐 整体传输路径概览
> （从发送方主机到接收方主机）

我们以一个典型的例子来讲：一台主机A要通过因特网给远程主机B发送一个IP数据包。

这一路上，数据会经历：

    主机A ——> 本地交换机 ——> 本地路由器 ——> ……（可能很多中间路由器）…… ——> 接收方路由器 ——> 接收主机B

沿途，我们会见到这三种表：

| 表名  | 所属层 | 存在设备 | 作用  |
| --- | --- | --- | --- |
| ARP表 | 链路层 | 主机、路由器 | 查IP得MAC地址（用于本地链路发送） |
| 交换机表（Switch Table） | 链路层 | 交换机 | 查MAC得接口，实现帧转发 |
| 转发表（Forwarding Table） | 网络层 | 路由器 | 查目的IP得下一跳/输出端口 |

* * *

## 🧭 数据走过每个设备时，谁在起作用？

### **1️⃣ 主机A准备发送IP包**

主机A要把包发往IP地址为B的主机，它会：

* 查路由表（主机也有简单路由表）判断这个目标IP是不是同一网段：
  
  * 如果是同一网段 → 下一跳就是主机B
  * 如果不是 → 下一跳是默认网关（即本地路由器）
* 得到“下一跳IP”后，要通过**ARP表**获取下一跳的**MAC地址**：
  
  * 如果ARP表中没有该IP对应的MAC地址，就要发ARP请求，解析出来后放进ARP表中。
* 封装好MAC头后，把数据交给网卡发出。
  

✅ **此时工作的是：ARP表（主机A）**

* * *

### **2️⃣ 交换机接收到这个帧**

* 交换机收到以太帧，会提取帧头的目的MAC地址；
  
* 在自己的**交换机表（MAC表）** 中查这个MAC该走哪个端口；
  * 查到了就转发；
  * 没查到就广播；
* 同时记录源MAC地址和接口，以备将来使用。
  

✅ **此时工作的是：交换机表（switch table）**

* * *

### **3️⃣ 路由器收到这个帧**

* 路由器先通过帧头的目的MAC判断“帧是给我的”；
  
* 接着剥掉帧头，得到IP包；
  
* 用**转发表（forwarding table）** 查找目标IP该往哪条路径发：
  
  * 查找最长前缀匹配
  * 得到“下一跳IP”和输出端口
* 然后需要再次查ARP表，把“下一跳IP”转换为MAC地址
  
* 构造新的帧，再发送出去
  

✅ **此时工作的是：**

* 网络层的**转发表（路由器）**：查目的IP决定下一跳/端口；
* 链路层的**ARP表（路由器）**：查下一跳IP得到MAC地址；

* * *

### **4️⃣ 中间交换机们继续用MAC地址转发**

重复前面的交换机查MAC流程。

✅ **继续用交换机表（switch table）**

* * *

### **5️⃣ 到达目标主机**

目标主机收到帧后会解封装，交给操作系统网络栈处理。

* * *

## 🧠 总结对比：三个表的对照

| 表名  | 所在设备 | 所在层 | 查询依据 | 得到什么 | 何时用 |
| --- | --- | --- | --- | --- | --- |
| ARP表 | 主机/路由器 | 链路层 | IP地址 | MAC地址 | 发帧前 |
| 转发表 | 路由器 | 网络层 | 目标IP地址 | 下一跳IP + 端口 | 路由时 |
| 交换机表 | 交换机 | 链路层 | MAC地址 | 接口（输出端口） | 帧中继 |

* * *

## 📌 谁先谁后？

在一个具体设备里，它们会协同工作：

* **主机：先查路由表 → 查ARP表 → 发帧**
* **交换机：不关心IP，只管MAC → 查交换机表转发帧**
* **路由器：收帧→拆封→查转发表→查ARP→再发帧**

* * *

## 🎯 小贴士：如何记住它们

| 名称  | 关键词 | 类比  |
| --- | --- | --- |
| ARP表 | IP → MAC | 电话簿：查号码找人 |
| 转发表 | IP前缀 → 下一跳接口 | 地图导航：决定路线 |
| 交换机表 | MAC → 接口 | 快递分拣：送到哪口 |

* * *


{% quote green %}
来自Deepseek
{% endquote %}


### **1. 三张表的本质区别**

| **表名称** | **所在设备** | **工作层级** | **匹配字段** | **输出结果** | **核心作用** |
| --- | --- | --- | --- | --- | --- |
| **转发表**（Forwarding Table） | 路由器 | 网络层（L3） | 目的IP（最长前缀匹配） | 下一跳IP + 出口接口 | 决定IP分组从哪个接口转发到下一跳 |
| **ARP表** | 路由器/主机 | 网络层→链路层 | 下一跳IP | 下一跳MAC地址 | 将下一跳IP解析为MAC地址 |
| **交换机表**（MAC表） | 交换机 | 链路层（L2） | 目的MAC地址 | 出口接口（端口号） | 决定帧从哪个物理端口转发 |

* * *

### **2. 完整数据传输流程（以主机A → 主机B为例）**

假设主机A（IP: `192.168.1.100`）发送数据到主机B（IP: `10.1.1.1`），路径如下：**主机A → 交换机1 → 路由器 → 交换机2 → 主机B**

#### **阶段1：主机A发送数据**

1. **应用层**：生成数据（如HTTP请求）。
2. **运输层**：添加TCP头部（源端口: `54321`，目的端口: `80`）。
3. **网络层**：添加IP头部（源IP: `192.168.1.100`，目的IP: `10.1.1.1`）。
4. **链路层**：
  * 主机A需要知道**默认网关（路由器）的MAC地址**（因为主机B不在本地网络）。
  * 查ARP表：
    * 若已有路由器的MAC（如 `AA:BB:CC:DD:EE`），直接使用。
    * 若无，发送ARP请求获取。
  * 封装帧：
    
        源MAC: 主机A的MAC (00:1A:2B:3C:4D)  
        目的MAC: 路由器的MAC (AA:BB:CC:DD:EE)  
    

#### **阶段2：交换机1转发帧**

1. **交换机1**收到帧，查看目的MAC `AA:BB:CC:DD:EE`。
2. **查交换机表（MAC表）**：
  * 若表中记录 `AA:BB:CC:DD:EE` 对应端口2，则从端口2转发。
  * 若无记录，泛洪到所有端口（除接收端口）。
3. 帧到达路由器。

#### **阶段3：路由器处理IP分组**

1. **链路层**：路由器收到帧，剥离帧头，检查目的MAC是否匹配自己的接口MAC。
2. **网络层**：
  * 提取IP分组，查**转发表**（Forwarding Table）：
    * 匹配目的IP `10.1.1.1` 的最长前缀（如 `10.1.1.0/24`）。
    * 得到下一跳IP（如 `10.1.1.254`）和出口接口（如 `eth1`）。
  * **修改IP头部**：TTL减1，重新计算校验和。
3. **链路层**：
  * 查**ARP表**，将下一跳IP `10.1.1.254` 转为MAC地址（如 `66:77:88:99:00`）。
  * 重新封装帧：
    
        源MAC: 路由器eth1的MAC (11:22:33:44:55)  
        目的MAC: 下一跳的MAC (66:77:88:99:00)  
    
  * 从接口 `eth1` 发送帧。

#### **阶段4：交换机2转发帧**

1. **交换机2**收到帧，查看目的MAC `66:77:88:99:00`。
2. **查交换机表**：
  * 若记录 `66:77:88:99:00` 对应端口4，则从端口4转发。
  * 若无记录，泛洪。
3. 帧到达主机B。

#### **阶段5：主机B接收数据**

1. **链路层**：检查目的MAC是否匹配自己的MAC。
2. **网络层以上**：逐层解封装，最终交付给应用进程。